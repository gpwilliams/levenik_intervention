---
title: "Appendix B"
author: "Glenn Williams"
date: "14<sup>th</sup> August, 2019 (Last updated: `r format(Sys.time(), '%d<sup>th</sup> %B, %Y')`)"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

packages <- c(
  "tidyverse",
  "rlang",
  "here",
  "brms",
  "tidybayes",
  "bayestestR",
  "modelr",
  "ggforce",
  "ggrepel",
  "ggridges",
  "irr"
)

# load packages
lapply(packages, library, character.only = TRUE)

# load functions
r_function_list <- list.files(
  path = here("R", "00_functions"), 
  pattern = "R$",
  full.names = TRUE
)
purrr::walk(r_function_list, source)

# get citations
citations <- purrr::map(packages, citation)

# get file paths ----

# get model summaries only for easy loading
fitted_models_dir <- list.files(
  path = here("04_analysis", "01_models"),
  pattern = "rds$",
  full.names = TRUE
) %>% 
  str_subset("summary")
  

model_summaries_dir <- list.files(
  path = here("04_analysis", "02_summaries", "02_full-data"),
  pattern = "csv$",
  full.names = TRUE
)

plots_dir <- list.files(
  path = here("03_plots", "02_full-data"),
  pattern = "png$",
  full.names = TRUE
)

# load data ----

fitted_models <- purrr::map(fitted_models_dir, read_rds)

names(fitted_models) <- fitted_models_dir %>% 
  sub(".*/", "", .) %>% 
  substr(., 1, nchar(.)-4)
```

```{r define-renaming-variables}
summary_oldnames <- c(".value", "interval")
summary_newnames <- c("median", "percentile interval")
summary_drop <- c(".point", ".interval")
```

# Appendix B. Fitted Model Summaries

## Vocabulary Test Model

A summary of the population-level (fixed) effects for the Vocabulary Test model is provided below. This can be used to determine model diagnostics, coefficients, and estimates around these coefficients using 95% credible intervals. 

```{r exposure-model-summary, results = "asis"}
fitted_models[["exposure_model_summary"]]$fixed %>%
  as.data.frame() %>% 
  rownames_to_column(., var = "Parameter") %>% 
  merge_CI_limits(., `l-95% CI`, `u-95% CI`, decimals = 3) %>%
  select(Parameter:Est.Error, interval, everything()) %>% 
  split_dists() %>% 
  mutate(distribution = factor(distribution, levels = c("mu", "phi", "zoi", "coi"))) %>% 
  arrange(distribution) %>%
  rename_parameters(replacements = model_replacements) %>%
  table_cols_to_title(.) %>% 
  select(-Distribution) %>% 
  custom_kable() %>% 
  pack_rows(index = c("$\\mu$" = 8, "$\\phi$" = 8, "$\\alpha$" = 8, "$\\gamma$" = 8))
```

## Testing Phase Model

A summary of the Testing Phase model is provided below. This can be used to determine model diagnostics and coefficients. 

```{r testing-model-summary}
fitted_models[["testing_model_summary"]]$fixed %>% 
  as.data.frame() %>% 
  rownames_to_column(., var = "Parameter") %>% 
  merge_CI_limits(., `l-95% CI`, `u-95% CI`, decimals = 3) %>%
  select(Parameter:Est.Error, interval, everything()) %>% 
  split_dists() %>% 
  mutate(distribution = factor(distribution, levels = c("mu", "phi", "zoi", "coi"))) %>% 
  arrange(distribution) %>%
  rename_parameters(replacements = model_replacements) %>%
  table_cols_to_title(.) %>% 
  select(-Distribution) %>% 
  custom_kable() %>% 
  pack_rows(index = c("$\\mu$" = 24, "$\\phi$" = 24, "$\\alpha$" = 24, "$\\gamma$" = 24))
```

## Exploratory Covariate Testing Model

A summary of the Testing Phase model incorporating the mean scores in the vocabulary test as a covariate is provided below. This can be used to determine model diagnostics and coefficients. 

```{r testing-cov-model-summary}
fitted_models[["testing_cov_model_summary"]]$fixed %>%
  as.data.frame() %>% 
  rownames_to_column(., var = "Parameter") %>% 
  merge_CI_limits(., `l-95% CI`, `u-95% CI`, decimals = 3) %>%
  select(Parameter:Est.Error, interval, everything()) %>% 
  split_dists() %>% 
  mutate(distribution = factor(distribution, levels = c("mu", "phi", "zoi", "coi"))) %>% 
  arrange(distribution) %>%
  rename_parameters(replacements = model_replacements) %>%
  table_cols_to_title(.) %>% 
  select(-Distribution) %>% 
  custom_kable() %>% 
  pack_rows(index = c("$\\mu$" = 48, "$\\phi$" = 48, "$\\alpha$" = 48, "$\\gamma$" = 48))
```